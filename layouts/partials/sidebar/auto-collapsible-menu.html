<!-- Auto collapsible section menu -->
<ul class="list-unstyled collapsible-sidebar">
  {{- $current := . -}}
  {{- $section := $current.Section -}}

  {{- range (where .Site.Sections "Section" "in" $section) }}
    {{- range .Sections }}
      {{- $active := in $current.RelPermalink .RelPermalink -}}
      {{- $cid := printf "sec-%s" (md5 .RelPermalink) -}}
      <li class="mb-1">
        <button
          class="btn btn-toggle align-items-center rounded collapsed"
          data-bs-toggle="collapse"
          data-bs-target="#{{ $cid }}"
          aria-expanded="{{ if $active }}true{{ else }}false{{ end }}">
          {{ .Title }}
        </button>

        <div
          class="collapse{{ if $active }} show{{ end }}"
          id="{{ $cid }}"
          {{/* Uncomment to keep only one top-level section open at a time: */}}
          {{/* data-bs-parent=".collapsible-sidebar" */}}>
          <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">

            {{- range .Pages }}
              {{- if .IsNode }}
                {{- $active2 := in $current.RelPermalink .RelPermalink -}}
                {{- $cid2 := printf "sec-%s" (md5 .RelPermalink) -}}
                <li class="my-1 ms-3">
                  <button
                    class="btn btn-toggle align-items-center rounded collapsed"
                    data-bs-toggle="collapse"
                    data-bs-target="#{{ $cid2 }}"
                    aria-expanded="{{ if $active2 }}true{{ else }}false{{ end }}">
                    {{ .Title }}
                  </button>

                  <div
                    class="collapse{{ if $active2 }} show{{ end }}"
                    id="{{ $cid2 }}"
                    {{/* data-bs-parent="#{{ $cid }}" */}}>
                    <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">

                      {{- range .Pages }}
                        {{- if .IsNode }}
                          {{- $active3 := in $current.RelPermalink .RelPermalink -}}
                          {{- $cid3 := printf "sec-%s" (md5 .RelPermalink) -}}
                          <li class="my-1 ms-3">
                            <button
                              class="btn btn-toggle align-items-center rounded collapsed"
                              data-bs-toggle="collapse"
                              data-bs-target="#{{ $cid3 }}"
                              aria-expanded="{{ if $active3 }}true{{ else }}false{{ end }}">
                              {{ .Title }}
                            </button>

                            <div
                              class="collapse{{ if $active3 }} show{{ end }}"
                              id="{{ $cid3 }}"
                              {{/* data-bs-parent="#{{ $cid2 }}" */}}>
                              <ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small">
                                {{- range .Pages }}
                                  {{- $leafActive := in $current.RelPermalink .RelPermalink -}}
                                  <li>
                                    <a class="docs-link rounded{{ if $leafActive }} active{{ end }}"
                                       href="{{ .RelPermalink }}">{{ .Title }}</a>
                                  </li>
                                {{- end }}
                              </ul>
                            </div>
                          </li>
                        {{- else }}
                          {{- $leafActive := in $current.RelPermalink .RelPermalink -}}
                          <li>
                            <a class="docs-link rounded{{ if $leafActive }} active{{ end }}"
                               href="{{ .RelPermalink }}">{{ .Title }}</a>
                          </li>
                        {{- end }}
                      {{- end }}

                    </ul>
                  </div>
                </li>
              {{- else }}
                {{- $leafActive := in $current.RelPermalink .RelPermalink -}}
                <li>
                  <a class="docs-link rounded{{ if $leafActive }} active{{ end }}"
                     href="{{ .RelPermalink }}">{{ .Title }}</a>
                </li>
              {{- end }}
            {{- end }}

          </ul>
        </div>
      </li>
    {{- end }}
  {{- end }}
</ul>
