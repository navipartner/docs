---
title: "Getting orders from Shopify"
description: "New orders and order updates are downloaded from Shopify automatically. Learn more about the associated processes in this article."
lead: ""
date: 2023-07-11T11:12:44+02:00
lastmod: 2023-07-11T11:12:44+02:00
draft: false
images: []
menu:
  docs:
    parent: ""
    identifier: "getting_orders-4e03454a5c81e181a38da1f37d696c4f"
weight: 324
toc: true
type: docs
---

New orders and order updates are downloaded from Shopify automatically. Two periodic processes are responsible for that ([<ins>refer to **Job Queue Entries**<ins>]({{< ref "../../reference/autogenerated_setup/index.md" >}}) for reference). 


1. The connection with the Shopify servers is established, and query for new, cancelled and closed orders is performed. The results are saved in the **Import List**.

{{< alert icon="üìù" text="The process doesn't request all orders from Shopify, only those created/updated in Shopify after the last request has been run, or after the date/time specified in the <b>Get Orders Starting From</b> field on the <b>Shopify Integration Setup</b> page."/>}}

2. New entries (retrieved during the first process) in the **Import List** are processed, and consequently sales orders are updated (the new ones are created, the cancelled ones are deleted, and the closed ones are posted).


It's recommended to periodically check the **Job Queue Log Entries** and the **Import List** to make sure any potential errors are addressed.

All created sales orders in the system are assigned a **Shopify Order ID**. For the purpose of reporting the order progress (shipping items to the customer) back to Shopify, each **Sales Order Line** also gets assigned its own **Shopify Order Line ID**.

## Customer search routine

Customers are selected by using the **Customer search routine**. During the order import, the following customer lookup algorithm is applied:

1. The customer is looked up by their **Shopify ID**.                   
   ![Fragment of incoming Shopify order json file with the Shopify customer ID specified](getting-orders-shopify-customer-search.png)

   {{< alert icon="üìù" text="Each time a customer is created during the Shopify order import process, the Shopify ID of the customer is saved in the <b>Shopify Customer ID</b> field on the <b>Customer Card</b> page."/>}}

2. (If the customer isn't found in the first step) The system tries to find another customer either by email, phone, or both (depending on the provided value in the **Customer Mapping** field on the **E-commerce Store Card**).    
   If the system finds the customer, the Shopify ID will be assigned to them, so that the next time they can be found more quickly.         

{{< alert icon="‚ùó" text="The system will not use a customer if its Shopify ID is different than the one received in the order, even if the email/phone number are the same."/>}}

3. (If the customer still isn't found) The system creates a new customer if the **Allow Create Customers** option is enabled in the **E-commerce Store Card**.           
   In this case, the system uses the customer template specifies in the **Customer Config. Template Code** field on the **E-commerce Store Card**. The template is needed to fill-in fields and values which aren't sent to Shopify, but are required in Business Central.    
4. If **Allow Create Customers** is disabled, the system uses a predefined customer (assigned to the store through customer mappings, or directly specified in the **Customer No.** field on the **E-commerce Store Card**).        
   For more information, refer to the article on [<ins>E-commerce stores<ins>]({{< ref "../../how-to/sales_order_setup/index.md" >}}).

## Production vs. Sandbox

When downloading new orders from Shopify, the following orders are processed:

| Environment            | Condition for an order to be imported                 |
|------------------------|-------------------------------------------------------|
| Production             | JSON key ‚Äúfinancial_status‚Äù = ‚Äúauthorized‚Äù            | 
| Sandbox                | JSON key ‚Äúfinancial_status‚Äù in ‚Äúauthorized‚Äù or ‚Äúpaid‚Äù | 

{{< alert icon="üí°" text="This is useful when testing the functionality."/>}}

### Next steps

- [<ins>Send data back to Shopify<ins>]({{< ref "../send_data_back/index.md" >}})

